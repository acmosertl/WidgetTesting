<div id="madhabam-final-moon-widget" style="max-width:300px;">

┬а┬а<p style="text-align: center; color: #795548; font-weight: 600; font-size: 0.9em; margin: 10px;">ржЪржирзНржжрзНрж░ рждржерзНржп рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>

</div>

<script>

/* FINAL STANDALONE MOON WIDGET WITH FORCED BENGALI FONT */

(function(){

    // --- 1. FORCE FONT FIX using !important ---
    const styleTag = document.createElement('style');
    styleTag.innerHTML = `
        /* Import Noto Sans Bengali from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap');
        
        /* Apply font forcefully to the entire gadget with specific Bengali fonts */
        #madhabam-final-moon-widget, #madhabam-final-moon-widget * { 
            box-sizing: border-box; 
            font-family: 'Noto Sans Bengali', 'Kalpurush', 'SolaimanLipi', sans-serif !important; 
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale; 
            text-rendering: optimizeLegibility; 
            line-height: 1.4; 
            color: #333; 
        }
        /* Your preferred color for heading/emphasis */
        .compact-header .title { color: #795548 !important; }
        /* Ensuring Tithi labels are bold and readable */
        .info-label { font-weight: 700 !important; }
    `;
    document.head.appendChild(styleTag);
    // ---------------------------------------------------

┬а┬а┬а┬а// API Endpoints and Default Location (Kolkata)
┬а┬а┬а┬аconst API_OM = 'https://api.open-meteo.com/v1/forecast';
┬а┬а┬а┬аconst API_IP = 'https://ipapi.co/json/';
┬а┬а┬а┬аconst DEFAULT = { lat:22.57, lng:88.36, source:'рж╕рзНржерж┐рж░ рж╕рзНржерж╛ржирж╛ржЩрзНржХ', city:'ржХрж▓ржХрж╛рждрж╛' };
┬а┬а┬а┬аconst $ = id => document.getElementById(id);
┬а┬а┬а┬а
┬а┬а┬а┬а// --- Fallback Data (Panchika Data - Kolkata) ---
┬а┬а┬а┬аconst FALLBACK_DATA = {
┬а┬а┬а┬а┬а┬а┬а┬аmoon_r: 'рзжрзм:рзжрзо PM',┬а
┬а┬а┬а┬а┬а┬а┬а┬аmoon_s: 'рзжрзм:рззрзн AM',
┬а┬а┬а┬а┬а┬а┬а┬а// Using fixed dates for fallback (if API fails completely)
┬а┬а┬а┬а┬а┬а┬а┬аnextFull: new Date('2025-11-15T00:00:00Z'), 
┬а┬а┬а┬а┬а┬а┬а┬аnextNew: new Date('2025-11-29T00:00:00Z'),
┬а┬а┬а┬а};


┬а┬а┬а┬а// --- Localization and Formatting ---
┬а┬а┬а┬аfunction formatToBengali(isoDateString, isTime = false) {
┬а┬а┬а┬а┬а┬а┬а┬аif (!isoDateString || isoDateString === 'N/A') return 'тАФ';
┬а┬а┬а┬а┬а┬а┬а┬аtry {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аconst date = new Date(isoDateString);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аif (isNaN(date)) return 'тАФ';
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аconst options = { hour: '2-digit', minute: '2-digit', hour12: true, timeZone: 'Asia/Kolkata' };
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аif (isTime) {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а// Use the same reliable formatting function from the previously working code
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аreturn new Date(isoDateString).toLocaleTimeString("bn-BD",{hour:"2-digit",minute:"2-digit",hour12:true});
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а}
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аreturn date.toLocaleDateString('bn-BD', { day: '2-digit', month: '2-digit', year: 'numeric' });
┬а┬а┬а┬а┬а┬а┬а┬а} catch (e) {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аreturn 'тАФ';
┬а┬а┬а┬а┬а┬а┬а┬а}
┬а┬а┬а┬а}
┬а┬а┬а┬а
┬а┬а┬а┬аfunction toBengaliNumber(num) {
┬а┬а┬а┬а┬а┬а┬а┬а// Corrected Bengali number function (more concise and reliable)
┬а┬а┬а┬а┬а┬а┬а┬аreturn String(num).replace(/[0-9]/g,d=>"рзжрззрзирзйрзкрзлрзмрзнрзорзп"[d]);
┬а┬а┬а┬а}


┬а┬а┬а┬а// --- Dynamic SVG Helpers (Moon Phase Drawing) ---
┬а┬а┬а┬аfunction createMoonSVG(ageDays){
┬а┬а┬а┬а┬а┬а┬а┬аconst ns='http://www.w3.org/2000/svg';
┬а┬а┬а┬а┬а┬а┬а┬аconst svg = document.createElementNS(ns,'svg'); svg.setAttribute('viewBox','0 0 64 64'); svg.setAttribute('width','40'); svg.setAttribute('height','40');
┬а┬а┬а┬а┬а┬а┬а┬аconst base = document.createElementNS(ns,'circle');
┬а┬а┬а┬а┬а┬а┬а┬аbase.setAttribute('cx','32'); base.setAttribute('cy','32'); base.setAttribute('r','30');
┬а┬а┬а┬а┬а┬а┬а┬аbase.setAttribute('fill','#303f9f'); svg.appendChild(base);
┬а┬а┬а┬а┬а┬а┬а┬аconst synDays = 29.530588853;
        
        // Simplified SVG logic for better rendering (using the improved logic from my working code)
        const p = (ageDays % synDays) / synDays;
        const shift = Math.round((p - 0.5) * 32); 

        if (p < 0.98 && p > 0.02) { // Skip drawing on new/full moon for cleaner look
            const light = document.createElementNS(ns, 'path');
            light.setAttribute('fill', '#FFC107');
            let d;
            
            if (p < 0.5) { // Waxing (Shukla Paksha)
                const arcWidth = 30 * Math.cos(2 * Math.PI * p);
                d = `M 32 2 A 30 30 0 0 1 32 62 L 32 62 A 30 ${Math.abs(arcWidth)} 0 0 1 32 2 Z`;
            } else { // Waning (Krishna Paksha)
                const arcWidth = 30 * Math.cos(2 * Math.PI * p);
                d = `M 32 2 A 30 30 0 0 0 32 62 L 32 62 A 30 ${Math.abs(arcWidth)} 0 0 0 32 2 Z`;
            }
            light.setAttribute('d', d);
            svg.appendChild(light);
        } else if (p >= 0.48 && p <= 0.52) {
             base.setAttribute('fill', '#FFC107'); // Full Moon
        }
┬а┬а┬а┬а┬а┬а┬а┬аreturn svg.outerHTML;┬а
┬а┬а┬а┬а}
┬а┬а┬а┬а
┬а┬а┬а┬а// --- Engine Logic ---
┬а┬а┬а┬а
┬а┬а┬а┬а// Geolocation with GPS/IP Fallback
┬а┬а┬а┬аasync function loadCoordinates() {
┬а┬а┬а┬а┬а┬а┬а┬аtry {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аif(navigator.geolocation) {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аconst pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej, { timeout: 3000 }));
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аreturn { lat: pos.coords.latitude, lng: pos.coords.longitude, source: 'GPS', city: 'GPS ржЕржмрж╕рзНржерж╛ржи' };
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а}
┬а┬а┬а┬а┬а┬а┬а┬а} catch (e1) {}
┬а┬а┬а┬а┬а┬а┬а┬аtry {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аconst response = await fetch(API_IP);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аconst data = await response.json();
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аif (data.latitude && data.longitude) {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аreturn { lat: data.latitude, lng: data.longitude, source: 'IP Address', city: data.city || 'IP ржЕржмрж╕рзНржерж╛ржи' };
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а}
┬а┬а┬а┬а┬а┬а┬а┬а} catch (e2) {}
┬а┬а┬а┬а┬а┬а┬а┬аreturn DEFAULT;
┬а┬а┬а┬а}
┬а┬а┬а┬а
┬а┬а┬а┬а// Moon Phase and Paksha Compute (THIS IS THE FUNCTION YOU SAID WAS WORKING EXCEPT FOR NEXT TITHIS)
┬а┬а┬а┬аfunction computePhase(date){
┬а┬а┬а┬а┬а┬а┬а┬аconst epoch = Date.UTC(2000,0,6,18,14,0);
┬а┬а┬а┬а┬а┬а┬а┬аconst synMs = 29.530588853 * 24*3600*1000;
┬а┬а┬а┬а┬а┬а┬а┬аconst diff = date.getTime() - epoch;
┬а┬а┬а┬а┬а┬а┬а┬аconst ageMs = (diff % synMs + synMs) % synMs;
┬а┬а┬а┬а┬а┬а┬а┬аconst ageDays = ageMs / (24*3600*1000);
┬а┬а┬а┬а┬а┬а┬а┬аconst angle = 2*Math.PI*(ageDays/29.530588853);
┬а┬а┬а┬а┬а┬а┬а┬аconst illum = Math.round((1 - Math.cos(angle))/2 * 100);
┬а┬а┬а┬а┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬аlet name = '';
┬а┬а┬а┬а┬а┬а┬а┬аlet paksha = '';
        
        // This is the logic you wanted to keep for the current phase/paksha name:
┬а┬а┬а┬а┬а┬а┬а┬аif(ageDays < 15.765294) {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аpaksha = 'рж╢рзБржХрзНрж▓ржкржХрзНрж╖'; 
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аif(ageDays < 1) name='ржЕржорж╛ржмрж╕рзНржпрж╛';
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аelse if(ageDays < 8.382647) name='ржмрж░рзНржзржорж╛ржи ржЕрж░рзНржзржЪржирзНржжрзНрж░';
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аelse name='ржмрж░рзНржзржорж╛ржи ржЧрж┐ржнрж╛рж╕';
┬а┬а┬а┬а┬а┬а┬а┬а} else {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аpaksha = 'ржХрзГрж╖рзНржгржкржХрзНрж╖'; 
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аif(ageDays < 15.765294+1) name='ржкрзВрж░рзНржгрж┐ржорж╛';
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аelse if(ageDays < 23.147941) name='ржХрзНрж╖ржпрж╝ржорж╛ржи ржЧрж┐ржнрж╛рж╕';
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аelse name='рж╣рзНрж░рж╕рзНржм ржЕрж░рзНржзржЪржирзНржжрзНрж░';
┬а┬а┬а┬а┬а┬а┬а┬а}
        
        // Next Tithis are deliberately NOT calculated here, as they will be fetched from API.
        // Returning placeholder values that will be overwritten by API data in loadAll().
┬а┬а┬а┬а┬а┬а┬а┬аreturn { name, illum, paksha, nextFull: null, nextNew: null, ageDays };
┬а┬а┬а┬а}
┬а┬а┬а┬а
┬а┬а┬а┬а// --- Master Render Function: Builds only Moon Card HTML and CSS ---
┬а┬а┬а┬а
┬а┬а┬а┬аfunction buildWidget(data) {
┬а┬а┬а┬а┬а┬а┬а┬аconst phase = computePhase(new Date());
┬а┬а┬а┬а┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а// --- CSS Styles (Incorporated into the script's forced style) ---
┬а┬а┬а┬а┬а┬а┬а┬аconst css = `
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<style>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а/* Replicating the existing styles */
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.compact-card { background-color: #FFFFFF; border-radius: 10px; padding: 12px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); max-width: 300px; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.compact-header { display: flex; align-items: center; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed #E0E0E0; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.compact-header .icon { font-size: 1.4em; color: #FFC107; line-height: 1; margin-right: 6px; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.compact-header .title { color: #5D4037; font-size: 1.1em; font-weight: 700; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.time-row { display: flex; justify-content: space-between; margin: 6px 0; font-size: 0.95em; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.info-label { font-weight: 600; color: #555; white-space: nowrap; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.info-value { font-weight: 700; color: #000; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.location-tag { font-size: 0.75em; color: #999; text-align: right; margin-top: 8px; padding-top: 5px; border-top: 1px solid #E0E0E0; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.moon-panel { background-color: #F0F4F7; border-radius: 10px; padding: 12px; margin-bottom: 12px; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.moon-tide-top { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px dashed #D0D0D0; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.moon-info-meta { font-size: 0.9em; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а.moon-info-meta div:first-child { font-weight: 700; color: #303f9f; }
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а</style>
┬а┬а┬а┬а┬а┬а┬а┬а`;
        
┬а┬а┬а┬а┬а┬а┬а┬а// --- 2. Moon Times & Phase HTML ---
        // **data.nextFull / data.nextNew now hold the API Tithi dates (or fallback)**
┬а┬а┬а┬а┬а┬а┬а┬аconst moonPanelHTML = `
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div class="compact-card moon-panel">
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div class="compact-header">
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<span class="icon">ЁЯМЩ</span>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<span class="title">ржЪржирзНржжрзНрж░ рж╕ржорзЯ ржУ ржкрж░рзНржпрж╛рзЯ</span>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а</div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div class="time-row"><span class="info-label">ржЪржирзНржжрзНрж░рзЛржжржпрж╝:</span><span class="info-value">${data.moon_r || 'тАФ'}</span></div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div class="time-row"><span class="info-label">ржЪржирзНржжрзНрж░рж╛рж╕рзНржд:</span><span class="info-value">${data.moon_s || 'тАФ'}</span></div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div class="moon-tide-top" style="margin-top:15px;">
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div class="moon-svg-container">${createMoonSVG(phase.ageDays)}</div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div class="moon-info-meta">
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div>ржкрж░рзНржпрж╛ржпрж╝: ${phase.name} (${phase.paksha})</div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div>ржЖрж▓рзЛржХржорж╛рждрзНрж░рж╛: ${toBengaliNumber(phase.illum)}%</div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а</div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а</div>
┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а<div style="font-size:0.9em; margin-top:10px;">
                    <div class="time-row"><span class="info-label">ржкрж░ржмрж░рзНрждрзА ржкрзВрж░рзНржгрж┐ржорж╛:</span><span class="info-value">${data.nextFull || 'тАФ'}</span></div>
                    <div class="time-row"><span class="info-label">ржкрж░ржмрж░рзНрждрзА ржЕржорж╛ржмрж╕рзНржпрж╛:</span><span class="info-value">${data.nextNew || 'тАФ'}</span></div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а</div>
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а</div>
┬а┬а┬а┬а┬а┬а┬а┬а`;
┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а// 3. Location Tag (Source)
┬а┬а┬а┬а┬а┬а┬а┬аconst locationHTML = `<div class="location-tag">рж╕рзНржерж╛ржи рж╕рзВрждрзНрж░: ${data.source} | ${data.city}</div>`;
┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а// Combine all parts
┬а┬а┬а┬а┬а┬а┬а┬аreturn css + moonPanelHTML + locationHTML;
┬а┬а┬а┬а}
┬а┬а┬а┬а
┬а┬а┬а┬а// --- Main Loader Function ---
┬а┬а┬а┬а
┬а┬а┬а┬аasync function loadAll() {
┬а┬а┬а┬а┬а┬а┬а┬аlet STATE = { lat: DEFAULT.lat, lng: DEFAULT.lng, source: DEFAULT.source, city: DEFAULT.city, moon_r:null, moon_s:null, nextFull: null, nextNew: null };
┬а┬а┬а┬а┬а┬а┬а┬аconst targetElement = $('madhabam-final-moon-widget'); 
┬а┬а┬а┬а┬а┬а┬а┬аif (targetElement) { targetElement.innerHTML = buildWidget(STATE); } // Initial render
┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬аconst coords = await loadCoordinates();
┬а┬а┬а┬а┬а┬а┬а┬аSTATE.lat = coords.lat;
┬а┬а┬а┬а┬а┬а┬а┬аSTATE.lng = coords.lng;
┬а┬а┬а┬а┬а┬а┬а┬аSTATE.source = coords.source;
┬а┬а┬а┬а┬а┬а┬а┬аSTATE.city = coords.city;
┬а┬а┬а┬а┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а// Fetch Data from Open-Meteo API (includes moonrise, moonset, full_moon, new_moon)
┬а┬а┬а┬а┬а┬а┬а┬аtry {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аconst r2 = await fetch(API_OM + `?latitude=${STATE.lat}&longitude=${STATE.lng}&daily=moonrise,moonset,full_moon,new_moon&timezone=auto`);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аconst j2 = r2.ok ? await r2.json() : {};
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аif(j2.daily && j2.daily.moonrise && j2.daily.moonrise.length && j2.daily.moonrise[0] && j2.daily.moonrise[0] !== null){
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.moon_r = formatToBengali(j2.daily.moonrise[0], true);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.moon_s = formatToBengali(j2.daily.moonset[0], true);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а
                // *** TITHI CALCULATION FIX: Use API data for next tithis ***
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.nextFull = formatToBengali(j2.daily.full_moon[0], false); // API Full Moon Date
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.nextNew = formatToBengali(j2.daily.new_moon[0], false);   // API New Moon Date
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а} else {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а// API returned No Data/Null - Use Fallback Data
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.moon_r = FALLBACK_DATA.moon_r;
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.moon_s = FALLBACK_DATA.moon_s;
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.nextFull = formatToBengali(FALLBACK_DATA.nextFull, false);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.nextNew = formatToBengali(FALLBACK_DATA.nextNew, false);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а}
┬а┬а┬а┬а┬а┬а┬а┬а} catch(e) {
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а// API FAILED ENTIRELY (Network/Other Error) - Use Fallback Data
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.moon_r = FALLBACK_DATA.moon_r;
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.moon_s = FALLBACK_DATA.moon_s;
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.nextFull = formatToBengali(FALLBACK_DATA.nextFull, false);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аSTATE.nextNew = formatToBengali(FALLBACK_DATA.nextNew, false);
┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬а┬аconsole.error("API failed. Using Fallback Data.");
┬а┬а┬а┬а┬а┬а┬а┬а}
┬а┬а┬а┬а┬а┬а┬а┬а
┬а┬а┬а┬а┬а┬а┬а┬а// Final render with actual data
┬а┬а┬а┬а┬а┬а┬а┬аif (targetElement) { targetElement.innerHTML = buildWidget(STATE); }
┬а┬а┬а┬а}
┬а┬а┬а┬а
┬а┬а┬а┬аloadAll();
┬а┬а┬а┬аsetInterval(loadAll, 1800000); // Refresh every 30 minutes

})();

</script>
