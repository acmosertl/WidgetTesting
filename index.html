<!-- üåï MƒÅdhavam Ekadashi Hybrid Final LTS Version --><div id="ekadashi-widget" style="font-family: 'Shiliguri', 'Baluda', 'Noto Sans Bengali', sans-serif; background:#fff1d6; border-radius:16px; box-shadow:0 0 8px #c3a97c; padding:18px; text-align:center; max-width:420px; margin:auto;">
  <h3 style="color:#E53935; margin-bottom:10px;">üå∏ ‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
  <small id="update-info" style="color:#666;">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</small>
  <div id="ekadashi-table" style="margin-top:12px; max-height:400px; overflow-y:auto;"></div>
</div><script>
(async function(){
  const GH_JSON = "https://raw.githubusercontent.com/acmosertl/Madhavam-Surya-Siddhanto-Panjika-/main/ekadashi.json";
  const PROXY_API = "https://madhavam-surya-siddhanto-panjika.vercel.app/api/ekadashi-proxy";
  const REFRESH_HOURS = 12;
  const now = Date.now();
  const lastUpdate = localStorage.getItem("madhavam_ekadashi_updated");
  const ekDiv = document.getElementById("ekadashi-table");
  const info = document.getElementById("update-info");

  async function fetchData(){
    try {
      const res = await fetch(PROXY_API, {cache:"no-store"});
      if(!res.ok) throw new Error("Proxy failed");
      const json = await res.json();
      localStorage.setItem("madhavam_ekadashi_data", JSON.stringify(json.data || json));
      localStorage.setItem("madhavam_ekadashi_updated", now);
      return json.data || json;
    } catch {
      const res2 = await fetch(GH_JSON);
      const data = await res2.json();
      return data.data || data;
    }
  }

  async function getData(){
    let data = [];
    if(lastUpdate && now - lastUpdate < REFRESH_HOURS*3600*1000){
      const cached = localStorage.getItem("madhavam_ekadashi_data");
      if(cached) data = JSON.parse(cached);
    }
    if(!data || !data.length) data = await fetchData();
    renderTable(data);
  }

  function renderTable(list){
    if(!list || !list.length){ ekDiv.innerHTML="<p>‚ùå ‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</p>"; return; }
    let html="";
    const today = new Date();
    const todayStr = today.toISOString().split('T')[0];
    let currentFound = false;
    list.forEach(item=>{
      const isToday = item.date===todayStr;
      if(isToday && !currentFound){
        localStorage.setItem("currentEkadashi", JSON.stringify(item));
        currentFound=true;
      }
      html+=`
        <div style="border:1px solid #d1b075; border-radius:8px; margin-bottom:8px; padding:6px 10px; background:${isToday?'#fff9e6':'#fff'};">
          <b style="color:${isToday?'#E53935':'#444'};">${item.name}</b><br>
          <span style="font-size:13px;">üìÖ ${item.date}</span><br>
          ${item.parana?`<span style="font-size:12px; color:#555;">‡¶™‡¶æ‡¶∞‡¶£‡¶É ${item.parana}</span>`:''}
        </div>`;
    });
    ekDiv.innerHTML=html;
    info.textContent="‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (ISKCON + MƒÅdhavam)";
  }

  await getData();
})();
</script>
