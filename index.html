<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡¶Æ‡¶æ‡¶ß‡¶¨‡¶Æ ‚Ä¢ ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ (Compact)</title>
<style>
:root{
  --bg:#fff4e3; --card:#b71c1c; --pill:#ffe082; --txt:#ffffff;
  --accent:#ffd54f; --shadow:0 6px 18px rgba(0,0,0,.10);
  --soft:#fdf3d0; --muted:#ffdca8;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali",system-ui,sans-serif}
.wrap{max-width:460px;margin:8px auto;padding:8px}
.card{
  background:var(--card); color:var(--txt); border-radius:20px;
  padding:14px 16px; box-shadow:var(--shadow);
  /* height ‡¶π‡¶æ‡¶ó‡¶ø‡¶Ç‚Äî‡¶´‡¶æ‡¶Å‡¶ï‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ */
}
.h1{font-weight:900; font-size:22px; display:flex; align-items:center; gap:8px}
.h1 .flower{filter:drop-shadow(0 0 6px rgba(255,255,0,.35))}
.title{
  text-align:center; font-weight:900; font-size:38px; line-height:1.1;
  margin:12px 0 8px; text-shadow:0 0 20px rgba(255,255,0,.35);
}
.meta{font-size:18px; text-align:center; font-weight:800; margin:4px 0}
.paran{font-size:16px; text-align:center; background:rgba(255,255,255,.08);
  border-radius:12px; padding:8px; margin:8px 0 10px}
.loc{font-size:13px; opacity:.9; text-align:center}
.btn{
  display:block; width:100%; border:0; cursor:pointer;
  background:linear-gradient(90deg,#ffb300,#ff8f00);
  color:#4e1b00; font-weight:900; border-radius:14px;
  padding:10px 14px; margin-top:12px; font-size:16px;
}
.note{font-size:12px; opacity:.75; text-align:center; margin-top:8px}
.badge{display:inline-block;background:var(--pill);color:#5d3a00;
  border-radius:999px; padding:3px 10px; font-size:13px; font-weight:900}
.small{font-size:14px}
.hidden{display:none}

/* ‡¶Ö‡¶ü‡ßã-‡¶∞‡¶ø‡¶∏‡¶æ‡¶á‡¶ú ‡¶π‡¶ø‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶™‡¶æ‡¶∞ ‡¶Æ‡¶ø‡¶® ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶Æ */
.section{margin-bottom:10px}
</style>
</head>
<body>
<div class="wrap">
  <section class="card" id="ekCard">
    <div class="h1">
      <span class="flower">üå∏</span>
      <span>‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ</span>
      <span class="badge" id="veriBadge" title="Verified status">IST</span>
    </div>

    <div id="ekName" class="title">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶</div>
    <div id="ekDate" class="meta">‚Äî</div>
    <div id="ekLeft" class="meta">‚Äî</div>

    <div id="paranBox" class="paran hidden">‡¶™‡¶æ‡¶∞‡¶£: ‚Äî</div>
    <div class="loc" id="locLine">üìç ‡¶≠‡¶æ‡¶∞‡¶§ ¬∑ IST (UTC+05:30)</div>

    <button class="btn" id="openList">üîî ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
    <div class="note">‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶ó‡¶£‡¶®‡¶æ ‡¶≠‡¶æ‡¶∞‡¶§‡ßÄ‡ßü ‡¶Æ‡¶æ‡¶® ‡¶∏‡¶Æ‡ßü (IST) ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ‡•§</div>
  </section>
</div>

<script>
(() => {
  // --- Lightweight state (display only) ---
  const $ = id => document.getElementById(id);
  const state = {
    name: null, date: null, left: null, paran: null, verified: false,
    list: [] // popup list rows [{name, date, paran}]
  };

  // ---- UI helpers ----
  function setText(id, txt){ $(id).textContent = txt; }
  function show(id, yes=true){ $(id).classList[yes?'remove':'add']('hidden'); }
  function daysLeftStr(targetISO){
    try{
      const t = new Date(targetISO);
      // IST normalize
      const now = new Date();
      const istNow = new Date(now.getTime() + 330*60000);
      const diff = Math.ceil((t - istNow)/(24*3600*1000));
      return (diff>0? `${diff} ‡¶¶‡¶ø‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø` : (diff===0? '‡¶Ü‡¶ú' : `${Math.abs(diff)} ‡¶¶‡¶ø‡¶® ‡¶Ü‡¶ó‡ßá`));
    }catch(_){ return '‚Äî'; }
  }
  function fmtDateDDMMYYYY(iso){
    try{
      const d = new Date(iso);
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yy = d.getFullYear();
      return `${dd}-${mm}-${yy}`;
    }catch(_){ return '‚Äî'; }
  }

  // ---- Populate card ----
  function render(){
    setText('ekName', state.name || '‚Äî');
    setText('ekDate', state.date ? fmtDateDDMMYYYY(state.date) : '‚Äî');
    setText('ekLeft', state.date ? daysLeftStr(state.date) : '‚Äî');
    if(state.paran){
      $('paranBox').innerHTML = `‡¶™‡¶æ‡¶∞‡¶£: ${state.paran} ${state.verified ? '‚úì' : ''}`;
      show('paranBox', true);
    }else{
      show('paranBox', false);
    }
    $('veriBadge').textContent = state.verified ? 'Verified' : 'IST';
    autoResize();
  }

  // ---- Demo hybrid: you can replace these with your engine fetchers ----
  // Local (engine) pick
  function fromLocalEngine(){
    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶û‡ßç‡¶ú‡¶ø‡¶ï‡¶æ-‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶® ‡¶´‡¶≤ ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá (window.__M_EK ||= {...})
    const L = (window.__M_EK || null);
    if(L){
      state.name = L.name;
      state.date = L.dateISO;
    }
  }
  // ISKCON verify (proxy/JSON ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßá‡¶ì UI ‡¶ö‡¶≤‡¶¨‡ßá)
  async function fromIskcon(){
    try{
      // üëâ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∏‡¶ø URL ‡¶¨‡¶∏‡¶æ‡¶ì (keyless)‡•§ ‡¶Ü‡¶™‡¶æ‡¶§‡¶§ ‡¶°‡ßá‡¶Æ‡ßã ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶ø‡¶ï ‡¶Æ‡¶ï:
      // const r = await fetch('https://your-proxy/ekadasi.json',{cache:'no-store'});
      // const j = await r.json();
      // ---- Demo mock (remove in real):
      const j = {
        next:{ name:"‡¶∞‡¶Æ‡¶æ ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ", date:"2025-11-15T00:00:00+05:30", paran:"‡¶™‡¶∞‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶∏‡¶ï‡¶æ‡¶≤ 6:40‚Äì9:10 AM" },
        list:[
          {name:"‡¶∞‡¶Æ‡¶æ ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ", date:"2025-11-15", paran:"‡¶™‡¶∞‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶∏‡¶ï‡¶æ‡¶≤ 6:40‚Äì9:10"},
          {name:"‡¶â‡ßé‡¶•‡¶æ‡¶® ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ", date:"2025-11-30", paran:"‡¶™‡¶∞‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶∏‡¶ï‡¶æ‡¶≤ 6:40‚Äì9:10"},
          {name:"‡¶Æ‡ßã‡¶ï‡ßç‡¶ñ‡¶¶‡¶æ ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ", date:"2025-12-14", paran:"‡¶™‡¶∞‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶∏‡¶ï‡¶æ‡¶≤ 6:40‚Äì9:00"},
          {name:"‡¶∏‡¶æ‡¶´‡¶≤‡¶æ ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ", date:"2026-01-10", paran:"‡¶™‡¶∞‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶∏‡¶ï‡¶æ‡¶≤ 6:45‚Äì9:15"}
        ]
      };
      // verify match
      if(state.name && j.next && j.next.name && j.next.name.trim() === state.name.trim()){
        state.verified = true;
        state.paran = j.next.paran || null;
      }
      // ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ
      state.list = Array.isArray(j.list)? j.list : [];
    }catch(_){
      // ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßá ‚Äì verified off, ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶´‡¶æ‡¶Å‡¶ï‡¶æ
      state.verified = false;
      state.list = [];
    }
  }

  // ---- Popup open in parent (outside iframe) ----
  function openListPopup(){
    const rows = (state.list && state.list.length ? state.list : [
      // fallback rows (optional)
      {name: state.name || '‚Äî', date: state.date ? fmtDateDDMMYYYY(state.date) : '‚Äî', paran: state.paran || '‚Äî'}
    ]);
    const tableRows = rows.map(r=>`
      <tr>
        <td>${r.name||'‚Äî'}</td>
        <td>${typeof r.date==='string' && r.date.includes('-')? r.date : fmtDateDDMMYYYY(r.date||'')}</td>
        <td>${r.paran||'‚Äî'}</td>
      </tr>`).join('');
    const html = `
      <div class="mdh-modal">
        <div class="mdh-box" role="dialog" aria-label="‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ">
          <div class="mdh-head">
            <div>üå∏ ‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï ‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (IST)</div>
            <button class="mdh-x" data-close>‚úï</button>
          </div>
          <div class="mdh-body">
            <table class="mdh-table">
              <thead><tr><th>‡¶è‡¶ï‡¶æ‡¶¶‡¶∂‡ßÄ</th><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶™‡¶æ‡¶∞‡¶£</th></tr></thead>
              <tbody>${tableRows}</tbody>
            </table>
          </div>
        </div>
      </div>
      <style>
      .mdh-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
        backdrop-filter: blur(6px); background:rgba(0,0,0,.25); z-index:999999}
      .mdh-box{width:min(86vmin,560px); aspect-ratio:1/1; background:#fff4e3; border-radius:18px;
        box-shadow:0 20px 40px rgba(0,0,0,.25); overflow:hidden; display:flex; flex-direction:column}
      .mdh-head{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;
        background:#fff; font-weight:900; color:#6d3d00}
      .mdh-x{border:0;background:#e53935;color:#fff;border-radius:10px;padding:4px 8px;font-weight:900;cursor:pointer}
      .mdh-body{padding:10px;overflow:auto}
      .mdh-table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
      .mdh-table th,.mdh-table td{border-bottom:1px solid #f2d7a2;padding:8px 10px;text-align:left;font-size:14px}
      .mdh-table thead th{background:#ffe6b5}
      </style>
      <script>document.currentScript.closest('.mdh-modal').addEventListener('click',e=>{
        if(e.target.matches('.mdh-x')||e.target.classList.contains('mdh-modal')) e.currentTarget.remove();
      });<\/script>
    `;
    // parent popup request
    parent?.postMessage({type:'MADHABAM_MODAL_HTML', html}, '*');
  }

  // ---- Auto-resize (height to parent) ----
  function autoResize(){
    const h = document.documentElement.scrollHeight;
    parent?.postMessage({type:'MADHABAM_IFRAME_HEIGHT', height:h}, '*');
  }
  window.addEventListener('load', autoResize);
  window.addEventListener('resize', () => setTimeout(autoResize, 50));

  // ---- Boot: local first, then verify, then render ----
  fromLocalEngine(); // (optional) ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶® ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ü‡¶æ ‡¶ö‡¶≤‡ßá
  render();
  fromIskcon().then(render);

  // periodic self-checks
  setInterval(()=>{ fromIskcon().then(()=>{ render(); }); }, 12*60*60*1000); // 12 ‡¶ò‡¶®‡ßç‡¶ü‡¶æ
  // ‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡ßã‡¶¶‡ßü boundary ‡¶ß‡¶∞‡ßá ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∞‡ßã‡¶≤‡¶ì‡¶≠‡¶æ‡¶∞‚Äî‡¶™‡ßç‡¶∞‡¶§‡¶ø 30 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá UI ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
  setInterval(()=>render(), 30*60*1000);

  // events
  $('openList').addEventListener('click', openListPopup);

})();
</script>
</body>
</html>
